<link rel="import" href="../../polymer-siren-mixins/siren-entity-mixin.html">

<script>
(function() {
	/*
		@polymerMixin
		@mixes SirenEntityMixin
		@memberOf D2L.Polymer.Mixins;
	*/
	D2L.Polymer.Mixins.CompletionStatusMixin = function(superClass) {
		return class extends window.D2L.Polymer.Mixins.SirenEntityMixin(superClass) {

			constructor() {
				super();
			}

			static get properties() {
				return {
					completionCompleted: {
						type: String,
						value: '',
						computed: '_stringifyCount(completionCount.completed)'
					},
					completionTotal: {
						type: String,
						value: '',
						computed: '_stringifyCount(completionCount.total)'
					}
				};
			}

			_stringifyCount(count) {
				if ( count === undefined ||  count === null ) {
					return '';
				}
				return `${count}`;
			}

			_getCompletionStatus(activity) {
				var aboutSubEntity =  activity.getSubEntityByRel('about');
				if (aboutSubEntity && aboutSubEntity.getSubEntityByClass('completion')) {
					if (aboutSubEntity.getSubEntityByClass('completion').hasClass('completed')) {
						return 'complete';
					} else {
						return 'incomplete';
					}
				} else {
					if (aboutSubEntity.getSubEntityByClass('last-viewed') ) {
						return 'optional-viewed';
					}
					return 'optional';
				}
			}
		};
	};
	window.D2L = window.D2L || {};
	window.D2L.Polymer = window.D2L.Polymer || {};
	window.D2L.Polymer.Mixins = window.D2L.Polymer.Mixins || {};
	window.D2L.Polymer.Mixins.CompletionStatusMixin = D2L.Polymer.Mixins.CompletionStatusMixin;
})();
</script>
