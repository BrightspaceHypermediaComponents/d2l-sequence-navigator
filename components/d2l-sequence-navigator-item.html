<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../d2l-polymer-siren-behaviors/store/entity-behavior.html">
<link rel="import" href="d2l-module-link.html">
<link rel="import" href="d2l-activity-link.html">
<link rel="import" href="../../d2l-colors/d2l-colors.html">

<dom-module id="d2l-sequence-navigator-item">
	<template>
		<style>
			:host {
				display: block;
			}

			d2l-activity-link {
				padding: 10px 15px 10px 15px;
			}

			d2l-activity-link.launch-page {
				padding: 15px 20px 15px 20px;
				box-shadow: 0 -15px 0 -14px var(--d2l-color-mica);
			}

			d2l-activity-link:hover {
				cursor: pointer;
			}

			d2l-activity-link.standalone.current,
			d2l-activity-link.standalone:hover {
				background-color: #f2f8fc;
				border: 1px solid #99c5e5;
			}

			d2l-module-link, d2l-activity-link.standalone {
				background-color: white;
				border: 1px solid var(--d2l-color-mica);
				border-radius: 8px;
			}

			d2l-module-link.launch-page, d2l-activity-link.standalone.launch-page {
				border: none;
			}

		</style>
		<template is="dom-if" if="[[isStandaloneActivity]]">
			<d2l-activity-link
				href="[[getHref(entity)]]"
				token="[[token]]"
				current-activity="{{currentActivity}}"
				tabindex="0"
				class$="standalone [[_getLaunchPageClass(launchPage)]]"
				launch-page="[[launchPage]]"
			></d2l-activity-link>
		</template>
		<template is="dom-if" if="[[isModule]]">
			<d2l-module-link
				href="[[selfLink]]"
				token="[[token]]"
				current-activity="{{currentActivity}}"
				selected-module="{{selectedModule}}"
				class$="[[_getLaunchPageClass(launchPage)]]"
				launch-page="[[launchPage]]"
			></d2l-module-link>
		</template>
		<template is="dom-if" if="[[isModuleActivity]]">
			<d2l-activity-link
				href="[[getHref(entity)]]"
				token="[[token]]"
				current-activity="{{currentActivity}}"
				tabindex="0"
				class$="[[_getLaunchPageClass(launchPage)]]"
				launch-page="[[launchPage]]"
			></d2l-activity-link>
		</template>
	</template>
	<script>
		/*
		@memberOf D2L.Polymer.Mixins;
		@mixes SirenEntityMixin
		*/
		class D2LSequenceNavigatorItem extends Polymer.mixinBehaviors([
			D2L.PolymerBehaviors.Siren.EntityBehavior
		],
		Polymer.Element
		) {
			static get is() {
				return 'd2l-sequence-navigator-item';
			}
			static get properties() {
				return {
					selfLink:{
						type: String,
						computed: 'getHref(entity)'
					},
					currentActivity: {
						type: String,
						value: '',
						notify: true
					},
					selectedModule: {
						type: String,
						value: '',
						notify: true
					},
					isModule: {
						type: Boolean,
						computed: '_isModule(entity)'
					},
					isActivity: {
						type: Boolean,
						computed: '_isActivity(entity)'
					},
					isLessonChild: {
						type: Boolean,
						value: false
					},
					isStandaloneActivity: {
						type: Boolean,
						computed: '_isStandaloneActivity(entity)'
					},
					isModuleActivity: {
						type: Boolean,
						computed: '_isModuleActivity(entity)'
					},
					launchPage: {
						type: Boolean,
						value: false
					}
				};
			}

			getHref( entity ) {
				return entity && entity.getLinkByRel('self').href || '';
			}

			_isModule( entity ) {
				return entity && entity.hasClass('sequence-description');
			}

			_isActivity( entity ) {
				return entity && entity.hasClass('sequenced-activity');
			}

			_isStandaloneActivity( entity ) {
				return this._isActivity( entity ) && this.isLessonChild;
			}

			_isModuleActivity( entity ) {
				return this._isActivity( entity ) && !this.isLessonChild;
			}

			_getLaunchPageClass(launchPage) {
				return launchPage ? 'launch-page' : '';
			}
		}
		customElements.define(D2LSequenceNavigatorItem.is, D2LSequenceNavigatorItem);
	</script>
</dom-module>
