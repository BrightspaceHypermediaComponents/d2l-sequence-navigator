<link rel="import" href="../polymer-siren-mixins/siren-entity-mixin.html">
<link rel="import" href="./components/d2l-sequence-navigator-item.html">
<link rel="import" href="./components/d2l-lesson-link.html">
<link rel="import" href="./siren-entity.html">
<!--
'd2l-sequence-navigator'


@demo demo/index.html
-->

<dom-module id="d2l-sequence-navigator">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
			}
		</style>

		<template is="dom-if" if="[[isLesson]]">
			<d2l-lesson-link
				href="[[_rootHref]]"
				token="[[token]]"
				current-activity="{{currentActivity}}"
			></d2l-lesson-link>
		</template>
		<d2l-siren-entity href="[[_moduleHref]]" token="[[token]]" entity="{{_moduleEntity}}"></d2l-siren-entity>
		<template is="dom-if" if="[[!isLesson]]">
			<d2l-sequence-navigator-item
				href="[[_rootHref]]"
				token="[[token]]"
				current-activity="{{currentActivity}}"
				selected-module="{{selectedModule}}"
			></d2l-sequence-navigator-item>
		</template>
	</template>
	<script>
		/*
		@memberOf D2L.Polymer.Mixins;
		@mixes SirenEntityMixin
		*/
		class D2LSequenceNavigator extends D2L.Polymer.Mixins.SirenEntityMixin( Polymer.Element ) {
			static get is() {
				return 'd2l-sequence-navigator';
			}
			static get properties() {
				return {
					currentActivity: {
						type: String,
						value: '',
						notify: true
					},
					selectedModule: {
						type: String,
						value: ''
					},
					_rootHref: {
						type: String,
						computed: '_getDirectParentHref(_moduleEntity)'
					},
					isLesson: {
						type: Boolean,
						value: false
					},
					_moduleEntity: {
						type: Object
					},
					_moduleHref: {
						type: String,
						computed: '_getModuleHref(entity)'
					}
				};
			}

			_getModuleHref(entity) {
				if (entity && this._hasClass( entity, 'sequence-description') ) {
					var selfLink = this._getLinkByRel( entity, 'self' );
					return selfLink && selfLink.href || '';
				}
				return entity && this._hasClass(entity, 'sequenced-activity') && this._getDirectParentHref( entity ) || '';
			}

			_getDirectParentHref(entity) {
				const upLink = this._getLinkByRel( entity, 'up' );
				return upLink && upLink.href || '';
			}
		}

		window.customElements.define(D2LSequenceNavigator.is, D2LSequenceNavigator);
	</script>
</dom-module>
